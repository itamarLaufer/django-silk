{% extends "silk/base/detail_base.html" %}
{% load silk_filters %}
{% load silk_nav %}
{% load silk_inclusion %}

{% block js %}
    {{ block.super }}
    <script>
        $(document).ready(function () {
            configureSpanFontColors($('#num-joins-div').find('.numeric'), 3, 5);
            configureSpanFontColors($('#time-taken-div').find('.numeric'), 200, 500);
        });
    </script>
{% endblock %}

{% block style %}
    {{ block.super }}
    <style>
        #traceback {
            width: 960px;
            margin: auto;
        }

        #traceback pre {
            margin-top: 15px !important;
            margin-bottom: 15px !important;
        }


        a:hover {
            color: #9dd0ff;
        }

        a:active {
            color: #594F4F;
        }

        code {
            background-color: transparent !important;
        }

        #query-div pre {
            background-color: transparent !important;
        }

        #query-div {
            padding-top: 15px;
        }

        #query-info-div div {
            padding-top: 5px;
        }

        .file-path {
            font-size: 13px;
        }



    </style>
{% endblock %}

{% block menu %}

    <a href="
        {% if silk_request and profile %}
            {% url "silk:request_and_profile_api_calls" silk_request.id profile.id %}
        {% elif silk_request %}
            {% url "silk:request_api_calls" silk_request.pk %}
        {% elif profile %}
            {% url "silk:profile_api_calls" profile.pk %}
        {% endif %}
    ">
        <div class="menu-item selectable-menu-item">
            <div class="menu-item-outer">
                <div class="menu-item-inner">&larr;</div>
            </div>
        </div>
    </a>

    <div class="menu-item menu-item-selected">
        <div class="menu-item-outer ">
            <div class="menu-item-inner">API Call</div>
        </div>
    </div>
{% endblock %}

{% block data %}
    <div class="wrapper">
        <div id="query-div">
            <div id="query-info-div">
            <div class="cell">
                <div class="method-div">{% if api_call.status_code %}{{ api_call.status_code }} {% endif %}{{ api_call.method }}</div>
                <div class="path-div">{{ api_call.url }}</div>
                            <pre id="query"><code>{{ api_call.formatted_query_params|spacify|linebreaksbr }}</code></pre>

                    <div id="time-taken-div">
                        <sparn class="numeric">{{ api_call.time_taken }}<span class="unit">ms</span></sparn>
                    </div>
            </div>
            </div>
            </div>

        </div>
        <div id="traceback">
            <div class="heading">
                <div class="inner-heading">
                    Traceback
                </div>
            </div>
            <div class="description">
                The below is the Python stacktrace that leads up the execution of the above API call.
                Use it to figure out where and why this API is being called and whether or not
                it's actually neccessary.
            </div>
            {% for ln in traceback %}
                {% if ln %}
                    <div class="file-path">
                        {{ ln }}
                    </div>
                    {% if forloop.counter == pos %}
                        {% code code actual_line %}
                    {% endif %}
                {% endif %}
            {% endfor %}
        </div>
    </div>


{% endblock %}
